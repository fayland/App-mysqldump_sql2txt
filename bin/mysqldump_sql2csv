#!/usr/bin/perl

use strict;
use warnings;

$| = 1;

# mysqldump -uroot -p mysql help_keyword > help_keyword.sql
my $sql_file = shift @ARGV;
die ".sql should be passed" unless $sql_file;

my $size = 4096;
$size = 100 if $ENV{TEST_MYSQLDUMP_SQL2CSV};

my $buf;
open(my $fh, '<', $sql_file) or die "Can't open $sql_file: $!\n";
while (sysread($fh, my $bytes, $size)) {
    $buf .= $bytes;
    while ($buf =~ s/^INSERT INTO \`(.*?)\` VALUES (.*?)\;$//m) {
        my $insert_line = $2;

        # I know it will be broken in some certain case but I do not have that case
        while ($insert_line =~ s/\((.*?)\)((\,\()|$)/$2/) { ## ends with '),(' or ')$'
            my ($pair, $splitter) = ($1, $2);
            $buf =~ s/^\,//;

            print "$pair\n"; # just print out
        }
    }
}
close($fh);

1;